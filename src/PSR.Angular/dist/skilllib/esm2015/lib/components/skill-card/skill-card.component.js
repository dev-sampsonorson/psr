import { Component, HostBinding, HostListener, Input } from '@angular/core';
import { BlockUiDirective } from '@sharedlib';
import { SKILL_CARD_TOKEN } from '../skill-list-display/skill-card.token';
import * as i0 from "@angular/core";
import * as i1 from "@angular/router";
import * as i2 from "../../services/skill-card-context-menuitem.service";
import * as i3 from "@sharedlib";
import * as i4 from "@angular/common";
export class SkillCardComponent {
    constructor(el, router, renderer, ctxMenuItem) {
        this.el = el;
        this.router = router;
        this.renderer = renderer;
        this.ctxMenuItem = ctxMenuItem;
        this.blockUiDirective = new BlockUiDirective(this.el, this.renderer);
        this.menuItems = [];
        this._blockCard = false;
        // @Output() skillCardClick = new EventEmitter<ISkill>();
        this.isContextMenuVisible = false;
        this.contextMenuHandle = Symbol('contextMenuHandle');
        this.type = 'overview';
        this._eventComplete$ = this.ctxMenuItem.onEventComplete$;
    }
    set blockCard(value) {
        this._blockCard = value;
        // this.cdr.markForCheck();
        this.blockUiDirective.toggleBlockUi(value);
    }
    get blockCard() {
        return this._blockCard;
    }
    ngOnInit() { }
    getCategoryInfo(skill) {
        return `${skill.categoryName} / ${skill.subcategoryName}`;
    }
    onHandleEscape(e) {
        if (e.key === 'Esc' || e.key === 'Escape') {
            if (this.isContextMenuVisible)
                this.isContextMenuVisible = false;
        }
    }
    onToggleContextMenu() {
        this.isContextMenuVisible = !this.isContextMenuVisible;
    }
    onMenuItemClick({ menuItem, handle }) {
        var _a;
        const routerLink = menuItem.routerLink((_a = this.skill) === null || _a === void 0 ? void 0 : _a.id);
        if (menuItem.navigatable) {
            Array.isArray(routerLink)
                ? this.router.navigate(routerLink)
                : this.router.navigateByUrl(routerLink);
        }
        else {
            this.blockCard = true;
            this.skill && this.ctxMenuItem.start(this.skill.id, menuItem.name);
        }
        this._eventComplete$.subscribe(({ skillId, menuName }) => {
            if (this.skill && this.skill.id === skillId) {
                this.blockCard = false;
            }
        });
        this.isContextMenuVisible = false;
    }
    ngOnDestroy() {
        var _a;
        this.blockUiDirective.ngOnDestroy();
        (_a = this._eventCompleteSub) === null || _a === void 0 ? void 0 : _a.unsubscribe();
    }
}
SkillCardComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "12.2.11", ngImport: i0, type: SkillCardComponent, deps: [{ token: i0.ElementRef }, { token: i1.Router }, { token: i0.Renderer2 }, { token: i2.SkillCardContextMenuitemService }], target: i0.ɵɵFactoryTarget.Component });
SkillCardComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "12.2.11", type: SkillCardComponent, selector: "skl-card", inputs: { skill: "skill", menuItems: "menuItems" }, host: { listeners: { "document:keydown": "onHandleEscape($event)" }, properties: { "attr.xBlockui": "this.blockUiDirective" } }, providers: [{ provide: SKILL_CARD_TOKEN, useExisting: SkillCardComponent }], ngImport: i0, template: "<ng-container *ngIf=\"skill\">\n    <!-- (click)=\"skillCardClickHandler(skill)\" -->\n    <div tabindex=\"0\"\n         class=\"relative flex flex-col justify-between h-full p-4 space-y-4 text-left border border-gray-200 rounded-lg hover:border-gray-300 focus-within:ring-1 focus-within:ring-inset focus-within:ring-indigo-500\">\n        <h3 class=\"text-lg font-medium text-gray-700\">{{ skill.name}}</h3>\n        <div class=\"skill-stats\">\n            <div class=\"skill-stats__info\">\n                <span\n                      class=\"mr-4 text-xs font-thin text-gray-500 transition-colors duration-200 hover:text-gray-900\">Employees</span>\n                <span class=\"text-xl font-normal text-gray-700\">{{ skill.employees }}</span>\n            </div>\n            <div class=\"skill-stats__info\">\n                <span\n                      class=\"mr-4 text-xs font-thin text-gray-500 transition-colors duration-200 hover:text-gray-900\">Team\n                    Competency</span>\n                <span class=\"text-xl font-normal text-gray-700\">{{ skill.teamCompetency }}</span>\n            </div>\n        </div>\n        <div class=\"flex items-center h-5\">\n            <span title=\"{{getCategoryInfo(skill)}}\"\n                  class=\"flex-1 pr-2 text-sm font-thin text-gray-500 truncate\">{{getCategoryInfo(skill)}}</span>\n            <div class=\"relative\">\n                <app-button-icon (buttonClick)=\"onToggleContextMenu()\">\n                    <app-icon-dot-vertical></app-icon-dot-vertical>\n                </app-button-icon>\n                <button *ngIf=\"isContextMenuVisible\" (click)=\"onToggleContextMenu()\" class=\"close-overlay\"\n                        tabindex=\"-1\"></button>\n                <app-context-menu [handle]=\"contextMenuHandle\" *ngIf=\"isContextMenuVisible\"\n                                  (menuItemClick)=\"onMenuItemClick($event)\" [menuItems]=\"menuItems\"\n                                  class=\"absolute right-0 w-40\"></app-context-menu>\n            </div>\n        </div>\n    </div>\n    <!-- <ng-container #blockUiOverlay></ng-container> -->\n</ng-container>\n", styles: [":host{display:block;position:relative;width:100%;min-height:190px;cursor:pointer;--eui-blockui-overlay-border-radius: .5rem;--eui-blockui-cursor: wait;--eui-blockui-background-color: rgba(255, 255, 255, .7)}.skill-stats{display:flex;flex-wrap:wrap}.skill-stats__info{display:flex;flex-direction:column;flex:none}\n"], components: [{ type: i3.ButtonIconComponent, selector: "app-button-icon", inputs: ["ariaLabel"], outputs: ["buttonClick"] }, { type: i3.IconDotVerticalComponent, selector: "app-icon-dot-vertical" }, { type: i3.ContextMenuComponent, selector: "app-context-menu", inputs: ["handle", "menuItems"], outputs: ["menuItemClick"] }], directives: [{ type: i4.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "12.2.11", ngImport: i0, type: SkillCardComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'skl-card',
                    templateUrl: './skill-card.component.html',
                    styleUrls: ['./skill-card.component.scss'],
                    providers: [{ provide: SKILL_CARD_TOKEN, useExisting: SkillCardComponent }],
                    // changeDetection: ChangeDetectionStrategy.OnPush,
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i1.Router }, { type: i0.Renderer2 }, { type: i2.SkillCardContextMenuitemService }]; }, propDecorators: { blockUiDirective: [{
                type: HostBinding,
                args: ['attr.xBlockui']
            }], skill: [{
                type: Input
            }], menuItems: [{
                type: Input
            }], onHandleEscape: [{
                type: HostListener,
                args: ['document:keydown', ['$event']]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2tpbGwtY2FyZC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9za2lsbGxpYi9zcmMvbGliL2NvbXBvbmVudHMvc2tpbGwtY2FyZC9za2lsbC1jYXJkLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL3NraWxsbGliL3NyYy9saWIvY29tcG9uZW50cy9za2lsbC1jYXJkL3NraWxsLWNhcmQuY29tcG9uZW50Lmh0bWwiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBYyxXQUFXLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBcUIsTUFBTSxlQUFlLENBQUM7QUFFM0csT0FBTyxFQUFFLGdCQUFnQixFQUFzRCxNQUFNLFlBQVksQ0FBQztBQUtsRyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx3Q0FBd0MsQ0FBQzs7Ozs7O0FBUzFFLE1BQU0sT0FBTyxrQkFBa0I7SUE0QjNCLFlBQ1ksRUFBYyxFQUNkLE1BQWMsRUFDZCxRQUFtQixFQUNuQixXQUE0QztRQUg1QyxPQUFFLEdBQUYsRUFBRSxDQUFZO1FBQ2QsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsZ0JBQVcsR0FBWCxXQUFXLENBQWlDO1FBL0IxQixxQkFBZ0IsR0FBRyxJQUFJLGdCQUFnQixDQUFDLElBQUksQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBTXJGLGNBQVMsR0FBb0IsRUFBRSxDQUFDO1FBRWpDLGVBQVUsR0FBWSxLQUFLLENBQUM7UUFJcEMseURBQXlEO1FBRWxELHlCQUFvQixHQUFZLEtBQUssQ0FBQztRQUN0QyxzQkFBaUIsR0FBVyxNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUN4RCxTQUFJLEdBQW9DLFVBQVUsQ0FBQztRQW1CdEQsSUFBSSxDQUFDLGVBQWUsR0FBRyxJ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QixLQUFLO3NCQUFiLEtBQUs7Z0JBQ0csU0FBUztzQkFBakIsS0FBSztnQkF1Q04sY0FBYztzQkFEYixZQUFZO3VCQUFDLGtCQUFrQixFQUFFLENBQUMsUUFBUSxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBIb3N0QmluZGluZywgSG9zdExpc3RlbmVyLCBJbnB1dCwgT25Jbml0LCBSZW5kZXJlcjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBCbG9ja1VpRGlyZWN0aXZlLCBJQmxvY2thYmxlVWksIElDb250ZXh0TWVudUl0ZW1DbGlja0V2ZW50LCBNZW51SXRlbSB9IGZyb20gJ0BzaGFyZWRsaWInO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZSwgU3Vic2NyaXB0aW9uIH0gZnJvbSAncnhqcyc7XG5cbmltcG9ydCB7IElTa2lsbCwgSVNraWxsQ2FyZCB9IGZyb20gJy4uLy4uL21vZGVscy9za2lsbC5tb2RlbCc7XG5pbXBvcnQgeyBTa2lsbENhcmRDb250ZXh0TWVudWl0ZW1TZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2VydmljZXMvc2tpbGwtY2FyZC1jb250ZXh0LW1lbnVpdGVtLnNlcnZpY2UnO1xuaW1wb3J0IHsgU0tJTExfQ0FSRF9UT0tFTiB9IGZyb20gJy4uL3NraWxsLWxpc3QtZGlzcGxheS9za2lsbC1jYXJkLnRva2VuJztcblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICdza2wtY2FyZCcsXG4gICAgdGVtcGxhdGVVcmw6ICcuL3NraWxsLWNhcmQuY29tcG9uZW50Lmh0bWwnLFxuICAgIHN0eWxlVXJsczogWycuL3NraWxsLWNhcmQuY29tcG9uZW50LnNjc3MnXSxcbiAgICBwcm92aWRlcnM6IFt7IHByb3ZpZGU6IFNLSUxMX0NBUkRfVE9LRU4sIHVzZUV4aXN0aW5nOiBTa2lsbENhcmRDb21wb25lbnQgfV0sXG4gICAgLy8gY2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG59KVxuZXhwb3J0IGNsYXNzIFNraWxsQ2FyZENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgSVNraWxsQ2FyZCwgSUJsb2NrYWJsZVVpIHtcbiAgICBASG9zdEJpbmRpbmcoJ2F0dHIueEJsb2NrdWknKSBibG9ja1VpRGlyZWN0aXZlID0gbmV3IEJsb2NrVWlEaXJlY3RpdmUodGhpcy5lbCwgdGhpcy5yZW5kZXJlcik7XG5cbiAgICAvLyBAVmlld0NoaWxkKCdibG9ja1VpT3ZlcmxheScsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiB9KSBibG9ja1VpT3ZlcmxheUNvbnRhaW5lclJlZjogVmlld0NvbnRhaW5lclJlZiB8IHVuZGVmaW5lZDtcblxuICAgIC8vIEBPdXRwdXQoKSBjb250ZXh0TWVudUl0ZW1FdmVudCA9IG5ldyBFdmVudEVtaXR0ZXI8eyBza2lsbElkOiBzdHJpbmcsIG1lbnVOYW1lOiBzdHJpbmcsIGNhcmQ6IElTa2lsbENhcmQgfT4oKTtcbiAgICBASW5wdXQoKSBza2lsbDogSVNraWxsIHwgdW5kZWZpbmVkO1xuICAgIEBJbnB1dCgpIG1lbnVJdGVtczogTWVudUl0ZW08YW55PltdID0gW107XG5cbiAgICBwcml2YXRlIF9ibG9ja0NhcmQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBwcml2YXRlIF9ldmVudENvbXBsZXRlJDogT2JzZXJ2YWJsZTx7IHNraWxsSWQ6IHN0cmluZywgbWVudU5hbWU6IHN0cmluZyB9PjtcbiAgICBwcml2YXRlIF9ldmVudENvbXBsZXRlU3ViOiBTdWJzY3JpcHRpb24gfCB1bmRlZmluZWQ7XG5cbiAgICAvLyBAT3V0cHV0KCkgc2tpbGxDYXJkQ2xpY2sgPSBuZXcgRXZlbnRFbWl0dGVyPElTa2lsbD4oKTtcblxuICAgIHB1YmxpYyBpc0NvbnRleHRNZW51VmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuICAgIHB1YmxpYyBjb250ZXh0TWVudUhhbmRsZTogU3ltYm9sID0gU3ltYm9sKCdjb250ZXh0TWVudUhhbmRsZScpO1xuICAgIHB1YmxpYyB0eXBlOiAnYWRkJyB8ICdvdmVydmlldycgfCAncGVyc29uYWwnID0gJ292ZXJ2aWV3JztcblxuICAgIHB1YmxpYyBzZXQgYmxvY2tDYXJkKHZhbHVlOiBib29sZWFuKSB7XG4gICAgICAgIHRoaXMuX2Jsb2NrQ2FyZCA9IHZhbHVlO1xuICAgICAgICAvLyB0aGlzLmNkci5tYXJrRm9yQ2hlY2soKTtcbiAgICAgICAgdGhpcy5ibG9ja1VpRGlyZWN0aXZlLnRvZ2dsZUJsb2NrVWkodmFsdWUpO1xuICAgIH1cbiAgICBwdWJsaWMgZ2V0IGJsb2NrQ2FyZCgpOiBib29sZWFuIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2Jsb2NrQ2FyZDtcbiAgICB9XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSBlbDogRWxlbWVudFJlZixcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICAgICAgcHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgICAgICBwcml2YXRlIGN0eE1lbnVJdGVtOiBTa2lsbENhcmRDb250ZXh0TWVudWl0ZW1TZXJ2aWNlLFxuICAgICAgICAvLyBwcml2YXRlIHpvbmU6IE5nWm9uZSxcbiAgICAgICAgLy8gcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmXG4gICAgKSB7XG4gICAgICAgIHRoaXMuX2V2ZW50Q29tcGxldGUkID0gdGhpcy5jdHhNZW51SXRlbS5vbkV2ZW50Q29tcGxldGUkO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCk6IHZvaWQgeyB9XG5cbiAgICBnZXRDYXRlZ29yeUluZm8oc2tpbGw6IElTa2lsbCk6IHN0cmluZyB7XG4gICAgICAgIHJldHVybiBgJHtza2lsbC5jYXRlZ29yeU5hbWV9IC8gJHtza2lsbC5zdWJjYXRlZ29yeU5hbWV9YDtcbiAgICB9XG5cbiAgICBASG9zdExpc3RlbmVyKCdkb2N1bWVudDprZXlkb3duJywgWyckZXZlbnQnXSlcbiAgICBvbkhhbmRsZUVzY2FwZShlOiBLZXlib2FyZEV2ZW50KSB7XG4gICAgICAgIGlmIChlLmtleSA9PT0gJ0VzYycgfHwgZS5rZXkgPT09ICdFc2NhcGUnKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0NvbnRleHRNZW51VmlzaWJsZSkgdGhpcy5pc0NvbnRleHRNZW51VmlzaWJsZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgb25Ub2dnbGVDb250ZXh0TWVudSgpIHtcbiAgICAgICAgdGhpcy5pc0NvbnRleHRNZW51VmlzaWJsZSA9ICF0aGlzLmlzQ29udGV4dE1lbnVWaXNpYmxlO1xuICAgIH1cblxuICAgIG9uTWVudUl0ZW1DbGljayh7IG1lbnVJdGVtLCBoYW5kbGUgfTogSUNvbnRleHRNZW51SXRlbUNsaWNrRXZlbnQpIHtcbiAgICAgICAgY29uc3Qgcm91dGVyTGluayA9IG1lbnVJdGVtLnJvdXRlckxpbmsodGhpcy5za2lsbD8uaWQpO1xuXG4gICAgICAgIGlmIChtZW51SXRlbS5uYXZpZ2F0YWJsZSkge1xuICAgICAgICAgICAgQXJyYXkuaXNBcnJheShyb3V0ZXJMaW5rKVxuICAgICAgICAgICAgICAgID8gdGhpcy5yb3V0ZXIubmF2aWdhdGUocm91dGVyTGluaylcbiAgICAgICAgICAgICAgICA6IHRoaXMucm91dGVyLm5hdmlnYXRlQnlVcmwocm91dGVyTGluayk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmJsb2NrQ2FyZCA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnNraWxsICYmIHRoaXMuY3R4TWVudUl0ZW0uc3RhcnQodGhpcy5za2lsbC5pZCwgbWVudUl0ZW0ubmFtZSk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9ldmVudENvbXBsZXRlJC5zdWJzY3JpYmUoKHsgc2tpbGxJZCwgbWVudU5hbWUgfSkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuc2tpbGwgJiYgdGhpcy5za2lsbC5pZCA9PT0gc2tpbGxJZCkge1xuICAgICAgICAgICAgICAgIHRoaXMuYmxvY2tDYXJkID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuaXNDb250ZXh0TWVudVZpc2libGUgPSBmYWxzZTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICAgICAgdGhpcy5ibG9ja1VpRGlyZWN0aXZlLm5nT25EZXN0cm95KCk7XG4gICAgICAgIHRoaXMuX2V2ZW50Q29tcGxldGVTdWI/LnVuc3Vic2NyaWJlKCk7XG4gICAgfVxufVxuIiwiPG5nLWNvbnRhaW5lciAqbmdJZj1cInNraWxsXCI+XG4gICAgPCEtLSAoY2xpY2spPVwic2tpbGxDYXJkQ2xpY2tIYW5kbGVyKHNraWxsKVwiIC0tPlxuICAgIDxkaXYgdGFiaW5kZXg9XCIwXCJcbiAgICAgICAgIGNsYXNzPVwicmVsYXRpdmUgZmxleCBmbGV4LWNvbCBqdXN0aWZ5LWJldHdlZW4gaC1mdWxsIHAtNCBzcGFjZS15LTQgdGV4dC1sZWZ0IGJvcmRlciBib3JkZXItZ3JheS0yMDAgcm91bmRlZC1sZyBob3Zlcjpib3JkZXItZ3JheS0zMDAgZm9jdXMtd2l0aGluOnJpbmctMSBmb2N1cy13aXRoaW46cmluZy1pbnNldCBmb2N1cy13aXRoaW46cmluZy1pbmRpZ28tNTAwXCI+XG4gICAgICAgIDxoMyBjbGFzcz1cInRleHQtbGcgZm9udC1tZWRpdW0gdGV4dC1ncmF5LTcwMFwiPnt7IHNraWxsLm5hbWV9fTwvaDM+XG4gICAgICAgIDxkaXYgY2xhc3M9XCJza2lsbC1zdGF0c1wiPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNraWxsLXN0YXRzX19pbmZvXCI+XG4gICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cIm1yLTQgdGV4dC14cyBmb250LXRoaW4gdGV4dC1ncmF5LTUwMCB0cmFuc2l0aW9uLWNvbG9ycyBkdXJhdGlvbi0yMDAgaG92ZXI6dGV4dC1ncmF5LTkwMFwiPkVtcGxveWVlczwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInRleHQteGwgZm9udC1ub3JtYWwgdGV4dC1ncmF5LTcwMFwiPnt7IHNraWxsLmVtcGxveWVlcyB9fTwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInNraWxsLXN0YXRzX19pbmZvXCI+XG4gICAgICAgICAgICAgICAgPHNwYW5cbiAgICAgICAgICAgICAgICAgICAgICBjbGFzcz1cIm1yLTQgdGV4dC14cyBmb250LXRoaW4gdGV4dC1ncmF5LTUwMCB0cmFuc2l0aW9uLWNvbG9ycyBkdXJhdGlvbi0yMDAgaG92ZXI6dGV4dC1ncmF5LTkwMFwiPlRlYW1cbiAgICAgICAgICAgICAgICAgICAgQ29tcGV0ZW5jeTwvc3Bhbj5cbiAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInRleHQteGwgZm9udC1ub3JtYWwgdGV4dC1ncmF5LTcwMFwiPnt7IHNraWxsLnRlYW1Db21wZXRlbmN5IH19PC9zcGFuPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzPVwiZmxleCBpdGVtcy1jZW50ZXIgaC01XCI+XG4gICAgICAgICAgICA8c3BhbiB0aXRsZT1cInt7Z2V0Q2F0ZWdvcnlJbmZvKHNraWxsKX19XCJcbiAgICAgICAgICAgICAgICAgIGNsYXNzPVwiZmxleC0xIHByLTIgdGV4dC1zbSBmb250LXRoaW4gdGV4dC1ncmF5LTUwMCB0cnVuY2F0ZVwiPnt7Z2V0Q2F0ZWdvcnlJbmZvKHNraWxsKX19PC9zcGFuPlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cInJlbGF0aXZlXCI+XG4gICAgICAgICAgICAgICAgPGFwcC1idXR0b24taWNvbiAoYnV0dG9uQ2xpY2spPVwib25Ub2dnbGVDb250ZXh0TWVudSgpXCI+XG4gICAgICAgICAgICAgICAgICAgIDxhcHAtaWNvbi1kb3QtdmVydGljYWw+PC9hcHAtaWNvbi1kb3QtdmVydGljYWw+XG4gICAgICAgICAgICAgICAgPC9hcHAtYnV0dG9uLWljb24+XG4gICAgICAgICAgICAgICAgPGJ1dHRvbiAqbmdJZj1cImlzQ29udGV4dE1lbnVWaXNpYmxlXCIgKGNsaWNrKT1cIm9uVG9nZ2xlQ29udGV4dE1lbnUoKVwiIGNsYXNzPVwiY2xvc2Utb3ZlcmxheVwiXG4gICAgICAgICAgICAgICAgICAgICAgICB0YWJpbmRleD1cIi0xXCI+PC9idXR0b24+XG4gICAgICAgICAgICAgICAgPGFwcC1jb250ZXh0LW1lbnUgW2hhbmRsZV09XCJjb250ZXh0TWVudUhhbmRsZVwiICpuZ0lmPVwiaXNDb250ZXh0TWVudVZpc2libGVcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtZW51SXRlbUNsaWNrKT1cIm9uTWVudUl0ZW1DbGljaygkZXZlbnQpXCIgW21lbnVJdGVtc109XCJtZW51SXRlbXNcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzPVwiYWJzb2x1dGUgcmlnaHQtMCB3LTQwXCI+PC9hcHAtY29udGV4dC1tZW51PlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDwhLS0gPG5nLWNvbnRhaW5lciAjYmxvY2tVaU92ZXJsYXk+PC9uZy1jb250YWluZXI+IC0tPlxuPC9uZy1jb250YWluZXI+XG4iXX0=